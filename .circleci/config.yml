version: 2.1

jobs:
  docker-on-macos:
    macos:
      xcode: "26.2.0"
    
    steps:
      - checkout
      
      - run:
          name: Check nested virtualization support
          command: |
            echo "=== CPU Info ===="
            sysctl -n machdep.cpu.brand_string
            sleep 30
            
            echo "=== Check VZ Support ==="
            swift -e 'import Virtualization; print("VZ Supported:", VZVirtualMachine.isSupported)'
            
            echo "=== Try VZ directly ==="
            limactl create --name=test-vz --vm-type=vz template:default --tty=false
            limactl start test-vz
            limactl shell test-vz -- uname -a
            limactl delete test-vz -f

workflows:
  build:
    jobs:
      - docker-on-macos

